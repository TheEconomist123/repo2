{"remainingRequest":"D:\\mail\\oesbecc\\outMailScreen\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\mail\\oesbecc\\outMailScreen\\src\\views\\user\\create.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\mail\\oesbecc\\outMailScreen\\src\\views\\user\\create.vue","mtime":1637304821636},{"path":"D:\\mail\\oesbecc\\outMailScreen\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1640070690350},{"path":"D:\\mail\\oesbecc\\outMailScreen\\node_modules\\babel-loader\\lib\\index.js","mtime":1640070643981},{"path":"D:\\mail\\oesbecc\\outMailScreen\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1640070690350},{"path":"D:\\mail\\oesbecc\\outMailScreen\\node_modules\\vue-loader\\lib\\index.js","mtime":1640070694148}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport {adduser,getUsersByPage ,getRolesByPage ,addUserIdAndRoleIds ,getRoleIdsByUserId ,updateUser} from '@/api/system.js';\n\n// import bounced from './bounced';\n export default {\n\tfilters:{\n\t\tstatusFilter(status){\n\t\t\tconst statusMap={\n\t\t\t\t'0':'启用',\n\t\t\t\t'1':'禁用'\n\t\t\t}\n\t\t\treturn statusMap[status]\n\t\t},\n\t\t\n\t\t\n\t\t\n\t\tmonStatusFilter(status){\n\t\t\tconst statusMap={\n\t\t\t\t'0':'操作系统',\n\t\t\t\t'1':'中间件',\n\t\t\t\t'2':'DB',\n\t\t\t\t'3':'应用'\n\t\t\t}\n\t\t\treturn statusMap[status]\n\t\t}\n\t\t\n\t},\n\t \n\t components:{\n\t\t// bounced\n\t },\n\t data(){\n\t\t return {\n\t\t\tquery: {\n\t\t\t  login: '',\n\t\t\t  name: '',\n\t\t\t  status: undefined,\n\t\t\t  page:1,\n\t\t\t  pageSize:5\n\t\t\t},\n\t\t\t \n\t\t\ttitle:'用户管理新增',\n\t\t\texpand: false,\n\t\t\t dialogType:'',\n\t\t\t showNext:false,\n\t\t\t canelTitle:'取消',\n\t\t\t stepstatus:'process',\n\t\t\t showStatus:true,\n\t\t\t loading:false,\n\t\t\t showVisible: false,\n\t\t\t selectedRowKeys:[],\n\t\t\t id:\"\",\n\t\t\t current:0,\n\t\t\t form: this.$form.createForm(this),\n\t\t\t rule:{\n\t\t\t   login:{ rules: [{ required: true, message: '请输入用户名' }],initialValue:''},\n\t\t\t   name:{ rules: [{ required: true, message: '请输入姓名' }],initialValue:''},\n\t\t\t   status:{ rules: [{ required: true, message: '请选择状态' }],initialValue:'1'},\n\t\t\t },\n\t\t\tcolumns: [\n\t\t\t  { title: '角色ID', dataIndex: 'id',align:'center' },\n\t\t\t  { title: '角色名称', dataIndex: 'name' ,align:'center'},\n\t\t\t  { title: '角色描述', dataIndex: 'desc',align:'center' },\n\t\t\t  { title: '角色状态', dataIndex: 'status',align:'center',scopedSlots: { customRender: 'status' } },\n\t\t\t \n\t\t\t],\n\tlist: [\n\t],\n\tpagination: {\n\t\t total:0,\n\t     defaultPageSize:5,\n\t     showTotal: total => `共 ${total} 条数据`,\n\t     showSizeChanger:true,\n\t     pageSizeOptions: ['5', '10', '15', '20'],\n\t     onChange:(page, pageSize)=>{\n\t       this.pagechage(page, pageSize);\n\t     },\n\t\t onShowSizeChange:(current,pageSize)=>{\n\t\t\t this.pageSizeChange(pageSize);\n\t\t }\n\t}\n\t\t }\n\t },\n\t computed: {\n\t   rowSelection() {\n\t \tconst { selectedRowKeys } = this;\n\t \treturn {\n\t \t  onChange: (selectedRowKeys, selectedRows) => {\n\t \t\t// console.log(`selectedRowKeys: ${selectedRowKeys}`, 'selectedRows: ', selectedRows);\n\t \t\tthis.enterData=selectedRows\n\t \t\t//console.log(this.enterData)\n\t \t  },\n\t \t\n\t \t};\n\t   },\n\t   \n\t },\n\t\n\t methods:{\n\t\t //显示绑定关联ID\n\t\t showId(query){\n\t\t\tthis.form.setFieldsValue(query)\n\t\t \t//console.log(query)\n\t\t },\n\t\t \n\t\t //新增\n\t\t CreateDialog() {\n\t\t\tthis.title='用户管理新增'\n\t\t\tthis.showNext = false\n\t\t\tthis.showStatus=true\n\t\t\tthis.iconType =\"form\"\n\t\t\tthis.showCanel = true\n\t\t\tthis.disabled=false\n\t\t\tthis.showVisible = true\n\t\t\tthis.current = 0\n\t\t\tthis.dialogType='create'\n\t\t\tthis.stepstatus =\"process\"\n\t\t\tthis.canelTitle=\"取消\"\n\t\t\tthis.showCanel = true\n\t\t\tthis.selectedRowKeys = []\n\t\t\tthis.form.resetFields();//清除缓存数据\n\t\t\tthis.query={\n\t\t\t  login: '',\n\t\t\t  name: '',\n\t\t\t  status: '',\n\t\t\t  page:1,\n\t\t\t  pageSize:5\n\t\t\t}\n\t\t },\n\t\t \n\t\t // 修改\n\t\t updateDialog(query){\n\t\t\tthis.title='用户管理修改'\n\t\t\tthis.showStatus=true\n\t\t\tthis.iconType =\"form\"\n\t\t\tthis.showCanel = true\n\t\t\tthis.disabled=false\n\t\t\tthis.showVisible = true\n\t\t\tthis.current = 0\n\t\t\tthis.dialogType='update'\n\t\t\tthis.canelTitle=\"取消\"\n\t\t\tthis.stepstatus =\"process\"\n\t\t\tthis.showCanel = true\n\t\t\tthis.selectedRowKeys = []\n\t\t\tthis.id=query.id;\n\t\t\tthis.query={\n\t\t\t  login: '',\n\t\t\t  name: '',\n\t\t\t  status: '',\n\t\t\t  page:1,\n\t\t\t  pageSize:5\n\t\t\t}\n\t\t\tthis.form.resetFields();//清除缓存数据 \n\t\t\t this.showNext = true\n\t\t\tthis.$nextTick(()=>{\n\t\t\t    this.form.setFieldsValue(query)\n\t\t\t});\n\t\t\t\n\t\t\t\n\t\t },\n\t\t \n\t\t getRoleIdsByUserId(){\n\t\t\t  let _this = this\n\t\t\t getRoleIdsByUserId({userId:this.id}).then(res=>{\n\t\t\t \tif(res.data.code=='0000'){\n\t\t\t \t\tthis.canelTitle=\"关闭\"\n\t\t\t \t\tthis.showCanel = true\n\t\t\t \t\tthis.showNext = true\n\t\t\t \t\tthis.current=1\n\t\t\t\t\tthis.selectedRowKeys = res.data.extend;\n\t\t\t \t\t}else{\n\t\t\t\t\tthis.current=1;\n\t\t\t\t\t_this.stepstatus = 'error';\n\t\t\t \t\t }\n\t\t\t \t\t}).catch(function(error){\n\t\t\t\t\t\tthis.current=1;\n\t\t\t \t\t _this.stepstatus = 'error';\n\t\t\t \t\t})\n\t\t },\n\t\t submitCreate(){\n\t\t\t if(this.current ==0){\n\t\t\t\t if(this.dialogType==\"create\"){\n\t\t\t\t\t this.create();\n\t\t\t\t }else if(this.dialogType==\"update\"){\n\t\t\t\t\t this.update();\n\t\t\t\t }\n\t\t\t\t \n\t\t\t }else if(this.current == 1){//添加关联表信息\n\t\t\t\t this.addUserIdAndRoleIds();\n\t\t\t }else{\n\t\t\t\t this.current=2\n\t\t\t }\n\t\t },\n\t\t // 直接进入第三步\n\t\t goNext(){\n\t\t\t if(this.current==0){\n\t\t\t\t\n\t\t\t\t  this.getList();\n\t\t\t\t  \n\t\t\t }else{\n\t\t\t\t this.canelTitle=\"关闭\"\n\t\t\t\t this.showCanel = true\n\t\t\t\t this.showNext = false\n\t\t\t\t  this.current=2\n\t\t\t }\n\t\t\n\t\t },\n\t\t \n\t\t \n\t\t addUserIdAndRoleIds(){\n\t\t\t let _this = this\n\t\t\t addUserIdAndRoleIds({userId:this.id,roleIds:this.selectedRowKeys.join(\",\")}).then(res=>{\n\t\t\t\t if(res.data.code=='0000'){\n\t\t\t\t\t this.canelTitle=\"关闭\"\n\t\t\t\t\t this.showCanel = true\n\t\t\t\t\t this.showNext = false\n\t\t\t\t\t this.current=2\n\t\t\t\t }else{\n\t\t\t\t\t this.$message.error(res.data.message)\n\t\t\t\t\t _this.stepstatus = 'error';\n\t\t\t\t }\n\t\t\t }).catch(function(error){\n\t\t\t\t\t _this.stepstatus = 'error';\n\t\t\t\t});\n\t\t },\n\t\t \n\t\t getList(){\n\t\t \tthis.loading=true\n\t\t \t getRolesByPage(this.query).then(res=>{\n\t\t \t\tif(res.data.code=='0000'){\n\t\t\t\t\tthis.showNext = true \n\t\t \t\t\tthis.loading=false\n\t\t\t\t\tthis.showCanel = false\n\t\t\t\t\tthis.current=1;\n\t\t \t\t\tconsole.log(res)\n\t\t \t\t\tthis.list = res.data.extend.list\n\t\t \t\t\tthis.pagination.total = res.data.extend.total;\n\t\t\t\t\tif(this.dialogType==\"update\"){\n\t\t\t\t\t\tthis.getRoleIdsByUserId()\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t \t\t}else{\n\t\t\t\t\tthis.current=1;\n\t\t\t\t\t_this.stepstatus = 'error';\n\t\t \t\t\tthis.loading=false\n\t\t \t\t\tthis.$message.error(res.data.message)\n\t\t \t\t}\n\t\t \t }).catch(function(error){\n\t\t\t\t\t\t  this.current=1;\n\t\t\t\t\t\t  _this.stepstatus = 'error';\n\t\t\t\t\t  })\n\t\t },\n\t\t //新增\n\t\t create(){\n\t\t\t let _this= this;\n\t\t \t\t this.form.validateFields((err, values) => {\n\t\t \t\t  if(!err){\n\t\t \t\t\t  adduser(values).then(res=>{\n\t\t \t\t\t\tif(res.data.code=='0000'){\n\t\t\t\t\t\t\tthis.id = res.data.extend;\n\t\t\t\t\t\t\tthis.$emit('fresh')\n\t\t\t\t\t\t\tthis.getList();\n\t\t\t\t\t\t\t\n\t\t \t\t\t\t\t//this.$message.success(res.data.message)\n\t\t\t\t\t\t\t\n\t\t \t\t\t\t\t\n\t\t \t\t\t\t}else{\n\t\t \t\t\t\t\tthis.$message.error(res.data.message)\n\t\t\t\t\t\t\t_this.stepstatus = 'error';\n\t\t \t\t\t\t}\n\t\t \t\t\t  }).catch(function(error){\n\t\t\t\t\t\t  _this.stepstatus = 'error';\n\t\t\t\t\t  })\n\t\t \t\t\t  //this.showVisible = false\n\t\t \t\t\t}\n\t\t \t\t  });\n\t\t },\n\t\t //修改\n\t\t update(){\n\t\t \t\t  this.form.validateFields((err, values) => {\n\t\t \t\t   if(!err){\n\t\t \t\t\t  updateUser(values).then(res=>{\n\t\t \t\t\t\t  //console.log(res)\n\t\t \t\t\t\tif(res.data.code=='0000'){\n\t\t\t\t\t\t\tthis.getList();\n\t\t \t\t\t\t\tthis.$message.success(res.data.message)\n\t\t \t\t\t\t\tthis.$emit('fresh')\n\t\t \t\t\t\t}else{\n\t\t \t\t\t\t\tthis.$message.error(res.data.message)\n\t\t \t\t\t\t}\n\t\t \t\t\t  })\n\t\t \t\t\t  \n\t\t \t\t\t}\n\t\t \t\t   });\n\t\t },\n\t\t onSelectChange(selectedRowKeys) {\n\t\t\t console.info(selectedRowKeys)\n\t\t   this.selectedRowKeys = selectedRowKeys;\n\t\t },\n\t\t //健康状态\n\t\t healthType(status){\n\t\t\t  if(status=='0'){\n\t\t\t\treturn 'success'\n\t\t\t  }else if(status=='1'){\n\t\t\t\treturn 'warning'\n\t\t\t  }else if(status=='2'){\n\t\t\t\treturn 'error'\n\t\t\t  }\n\t\t\t  else{\n\t\t\t\treturn 'default'\n\t\t\t  }\n\t\t },\n\t\t toggle() {\n\t\t \tthis.expand = !this.expand\n\t\t },\n\t\t \n\t\t //关闭\n\t\t onClose(){\n\t\t\t  this.showVisible = false;\n\t\t\t  this.form.resetFields();\n\t\t\t  this.$message.info('已取消操作！')\n\t\t },\n\t\t \n\t\t //选择归属ecc展示系统\n\t\t showBounced(){\n\t\t \tthis.$refs.bounced.showChildrenDrawer()\n\t\t \t// console.log(this.$refs.bounced)\n\t\t },\n\t },\n\n }\n\n",{"version":3,"sources":["create.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmIA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA","file":"create.vue","sourceRoot":"src/views/user","sourcesContent":["<template>\r\n\t<div>\r\n\t<a-drawer\r\n\t          placement=\"right\"\r\n\t          :closable=\"showCanel\"\r\n\t          :visible=\"showVisible\"\r\n\t\t\t   @close=\"onClose\"\r\n\t          width=\"1100px\">\r\n\t\t\t\t<span slot=\"title\">\r\n\t\t\t\t\t<a-icon :type=\"iconType\"/>&nbsp; {{title}}\r\n\t\t\t\t</span>\r\n\t\t\t\t\r\n\t\t\t\t<a-steps size=\"small\" :current=\"current\" :status = \"stepstatus\" >\r\n\t\t\t\t\t<a-step title=\"第一步\">\r\n\t\t\t\t\t\t<span slot=\"description\">{{title}}</span>\r\n\t\t\t\t\t</a-step>\r\n\t\t\t\t\t<a-step title=\"第二步\">\r\n\t\t\t\t\t\t<span slot=\"description\">角色管理</span>\r\n\t\t\t\t\t</a-step>\r\n\t\t\t\t\t<a-step title=\"结束\">\r\n\t\t\t\t\t</a-step>\r\n\t\t\t\t</a-steps>\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t<div class=\"stepContent\" v-show=\"current==0\">\r\n\t\t\t\t<a-form class=\"ant-advanced-search-form\" style=\"border:none;\" :form=\"form\">\r\n\t\t\t\t  <a-row :gutter=\"24\">\r\n\t\t\t\t    <a-col :span=\"24\">\r\n\t\t\t\t      <a-form-item label=\"登录名\" :label-col=\"{ span: 4 }\" :wrapper-col=\"{ span: 20 }\">\r\n\t\t\t\t    \t\t  <a-input type=\"hidden\" placeholder=\"请输入登录名\" :disabled=\"disabled\" v-decorator=\"['id']\"/>\r\n\t\t\t\t            <a-input placeholder=\"请输入登录名\" :disabled=\"disabled\" v-decorator=\"['login',rule.login]\"/>\r\n\t\t\t\t      </a-form-item>\r\n\t\t\t\t    </a-col>\r\n\t\t\t\t    <a-col :span=\"24\">\r\n\t\t\t\t      <a-form-item label=\"姓名\" :label-col=\"{ span: 4 }\" :wrapper-col=\"{ span: 20 }\">\r\n\t\t\t\t        <a-input  placeholder=\"请输入姓名\"  :disabled=\"disabled\" v-decorator=\"['name',rule.name]\"  />\r\n\t\t\t\t      </a-form-item>\r\n\t\t\t\t    </a-col>\r\n\t\t\t\t    \r\n\t\t\t\t    <a-col :span=\"24\">\r\n\t\t\t\t      <a-form-item label=\"状态\" :label-col=\"{ span: 4 }\" :wrapper-col=\"{ span: 20 }\">\r\n\t\t\t\t        <a-radio-group   :disabled=\"disabled\" v-decorator=\"['status',rule.status]\" >\r\n\t\t\t\t          <a-radio value=\"0\">禁用</a-radio>\r\n\t\t\t\t          <a-radio value=\"1\">启用</a-radio>\r\n\t\t\t\t        </a-radio-group>\r\n\t\t\t\t      </a-form-item>\r\n\t\t\t\t    </a-col>\r\n\t\t\t\t\t\r\n\t\t\t\t  </a-row>\r\n\t\r\n\t\t\t\t</a-form>\r\n\t\t\t</div>\r\n\t\t\t\t\r\n\t\t\t\t<!--第二步-->\r\n\t\t\t\t<div class=\"stepContent\" v-show=\"current==1\">\r\n\t\t\t\t\t\r\n\t\t\t\t\t<a-form class=\"ant-advanced-search-form\"\r\n\t\t\t\t\t        @submit=\"\" style=\"border:none;\">\r\n\t\t\t\t\t  <a-row :gutter=\"24\">\r\n\t\t\t\t\t   \r\n\t\t\t\t\t\t<a-col :span=\"8\">\r\n\t\t\t\t\t\t  <a-form-item label=\"角色名\" :label-col=\"{ span: 5 }\"\r\n\t\t\t\t\t\t\t:wrapper-col=\"{ span: 19 }\">\r\n\t\t\t\t\t\t    <a-input v-model=\"query.login\" placeholder=\"角色名\" />\r\n\t\t\t\t\t\t  </a-form-item>\r\n\t\t\t\t\t\t</a-col>\r\n\t\t\t\t\t\t<a-col :span=\"8\">\r\n\t\t\t\t\t\t  <a-form-item label=\"状态\" :label-col=\"{ span: 5 }\"\r\n\t\t\t\t\t\t\t:wrapper-col=\"{ span: 19 }\">\r\n\t\t\t\t\t\t<a-select defaultValue=\"0\" v-model=\"query.status\" style=\"width: 100%\" @change=\"handleChange\" placeholder=\"请选择状态\" allowClear=\"true\">\r\n\t\t\t\t\t\t  <a-select-option value=\"0\">禁用</a-select-option>\r\n\t\t\t\t\t\t  <a-select-option value=\"1\">启用</a-select-option>\r\n\t\t\t\t\t\t</a-select>\r\n\t\t\t\t\t\t  </a-form-item>\r\n\t\t\t\t\t\t</a-col>\r\n\t\t\t\t\t\t<a-col span=\"8\" :style=\"{ textAlign: 'right',paddingRight:'20px' }\">\r\n\t\t\t\t\t\t  <a-form-item>\r\n\t\t\t\t\t\t  <a-button type=\"primary\" @click=\"getList\" icon=\"search\">\r\n\t\t\t\t\t\t    搜&nbsp;&nbsp;索\r\n\t\t\t\t\t\t  </a-button>\r\n\t\t\t\t\t\t  <a-button :style=\"{ marginLeft: '8px' }\" @click=\"handleReset\" icon=\"redo\">\r\n\t\t\t\t\t\t    重&nbsp;&nbsp;置\r\n\t\t\t\t\t\t  </a-button>\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t    </a-form-item>\r\n\t\t\t\t\t\t</a-col>\r\n\t\t\t\t\t  </a-row>\r\n\t\t\t\t\t</a-form>\r\n\t\t\t\t\t\r\n\t\t\t\t\t<a-table rowKey=\"id\" :rowSelection=\"{selectedRowKeys: selectedRowKeys, onChange: onSelectChange}\" :columns=\"columns\" :dataSource=\"list\" bordered :pagination=\"pagination\">\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t<span slot=\"status\" slot-scope=\"status\">\r\n\t\t\t\t\t\t     <a-badge :status=\"status=='0'?'success':'error'\"/>\r\n\t\t\t\t\t\t     {{status | statusFilter}}\t\r\n\t\t\t\t\t\t </span>\r\n\t\t\t\t\t</a-table>\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t</div>\r\n\t\t\t\t\r\n\t\t\t\t<!-- 第三步 -->\r\n\t\t\t\t<div class=\"stepContent\" v-show=\"current==2\" style=\"text-align:center;marginTop:30px\">\r\n\t\t\t\t\t<a-icon type=\"check-circle\" style=\"color:green;font-size:50px;marginBottom:10px\"></a-icon>\r\n\t\t\t\t\t<p style=\"font-size:25px;\">{{this.dialogType=='create'?'新增成功':'修改成功'}}</p>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div :style=\"{\r\n\t\t\t\t               position: 'absolute',\r\n\t\t\t\t               left: 0,\r\n\t\t\t\t               bottom: 0,\r\n\t\t\t\t               width: '100%',\r\n\t\t\t\t               borderTop: '1px solid #e9e9e9',\r\n\t\t\t\t               padding: '10px 16px',\r\n\t\t\t\t               background: '#fff',\r\n\t\t\t\t               textAlign: 'right',\r\n\t\t\t\t             }\">\r\n\t\t\t\t\t<a-button type=\"primary\" @click=\"submitCreate\" v-show=\"current!=2\" :style=\"{marginRight:'5px'}\">\r\n\t\t\t\t\t\t\t   提交\r\n\t\t\t\t\t</a-button>\r\n\t\t\t\t\t<a-button type=\"success\" v-show=\"showNext\" @click=\"goNext\" :style=\"{marginRight:'5px'}\">\r\n\t\t\t\t\t\t\t   跳过\r\n\t\t\t\t\t</a-button>\r\n\t\t\t\t    <a-button :style=\"{marginRight: '8px'}\" @click=\"onClose\" v-if=\"showCanel\"> {{canelTitle}} </a-button>\r\n\t\t\t\t  </div>\r\n\t\t\t\t</a-drawer>\r\n\t\t\t\t<bounced ref='bounced' @showId=\"showId\"></bounced>\r\n\t\t\t</div>\t\n</template>\n\n<script>\r\n\timport {adduser,getUsersByPage ,getRolesByPage ,addUserIdAndRoleIds ,getRoleIdsByUserId ,updateUser} from '@/api/system.js';\r\n\t\r\n\t// import bounced from './bounced';\r\n\t export default {\r\n\t\tfilters:{\r\n\t\t\tstatusFilter(status){\r\n\t\t\t\tconst statusMap={\r\n\t\t\t\t\t'0':'启用',\r\n\t\t\t\t\t'1':'禁用'\r\n\t\t\t\t}\r\n\t\t\t\treturn statusMap[status]\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tmonStatusFilter(status){\r\n\t\t\t\tconst statusMap={\r\n\t\t\t\t\t'0':'操作系统',\r\n\t\t\t\t\t'1':'中间件',\r\n\t\t\t\t\t'2':'DB',\r\n\t\t\t\t\t'3':'应用'\r\n\t\t\t\t}\r\n\t\t\t\treturn statusMap[status]\r\n\t\t\t}\r\n\t\t\t\r\n\t\t},\r\n\t\t \r\n\t\t components:{\r\n\t\t\t// bounced\r\n\t\t },\r\n\t\t data(){\r\n\t\t\t return {\r\n\t\t\t\tquery: {\r\n\t\t\t\t  login: '',\r\n\t\t\t\t  name: '',\r\n\t\t\t\t  status: undefined,\r\n\t\t\t\t  page:1,\r\n\t\t\t\t  pageSize:5\r\n\t\t\t\t},\r\n\t\t\t\t \r\n\t\t\t\ttitle:'用户管理新增',\r\n\t\t\t\texpand: false,\r\n\t\t\t\t dialogType:'',\r\n\t\t\t\t showNext:false,\r\n\t\t\t\t canelTitle:'取消',\r\n\t\t\t\t stepstatus:'process',\r\n\t\t\t\t showStatus:true,\r\n\t\t\t\t loading:false,\r\n\t\t\t\t showVisible: false,\r\n\t\t\t\t selectedRowKeys:[],\r\n\t\t\t\t id:\"\",\r\n\t\t\t\t current:0,\r\n\t\t\t\t form: this.$form.createForm(this),\r\n\t\t\t\t rule:{\r\n\t\t\t\t   login:{ rules: [{ required: true, message: '请输入用户名' }],initialValue:''},\r\n\t\t\t\t   name:{ rules: [{ required: true, message: '请输入姓名' }],initialValue:''},\r\n\t\t\t\t   status:{ rules: [{ required: true, message: '请选择状态' }],initialValue:'1'},\r\n\t\t\t\t },\r\n\t\t\t\tcolumns: [\r\n\t\t\t\t  { title: '角色ID', dataIndex: 'id',align:'center' },\r\n\t\t\t\t  { title: '角色名称', dataIndex: 'name' ,align:'center'},\r\n\t\t\t\t  { title: '角色描述', dataIndex: 'desc',align:'center' },\r\n\t\t\t\t  { title: '角色状态', dataIndex: 'status',align:'center',scopedSlots: { customRender: 'status' } },\r\n\t\t\t\t \r\n\t\t\t\t],\r\n\t\tlist: [\r\n\t\t],\r\n\t\tpagination: {\r\n\t\t\t total:0,\r\n\t\t     defaultPageSize:5,\r\n\t\t     showTotal: total => `共 ${total} 条数据`,\r\n\t\t     showSizeChanger:true,\r\n\t\t     pageSizeOptions: ['5', '10', '15', '20'],\r\n\t\t     onChange:(page, pageSize)=>{\r\n\t\t       this.pagechage(page, pageSize);\r\n\t\t     },\r\n\t\t\t onShowSizeChange:(current,pageSize)=>{\r\n\t\t\t\t this.pageSizeChange(pageSize);\r\n\t\t\t }\r\n\t\t}\r\n\t\t\t }\r\n\t\t },\r\n\t\t computed: {\r\n\t\t   rowSelection() {\r\n\t\t \tconst { selectedRowKeys } = this;\r\n\t\t \treturn {\r\n\t\t \t  onChange: (selectedRowKeys, selectedRows) => {\r\n\t\t \t\t// console.log(`selectedRowKeys: ${selectedRowKeys}`, 'selectedRows: ', selectedRows);\r\n\t\t \t\tthis.enterData=selectedRows\r\n\t\t \t\t//console.log(this.enterData)\r\n\t\t \t  },\r\n\t\t \t\r\n\t\t \t};\r\n\t\t   },\r\n\t\t   \r\n\t\t },\r\n\t\t\r\n\t\t methods:{\r\n\t\t\t //显示绑定关联ID\r\n\t\t\t showId(query){\r\n\t\t\t\tthis.form.setFieldsValue(query)\r\n\t\t\t \t//console.log(query)\r\n\t\t\t },\r\n\t\t\t \r\n\t\t\t //新增\r\n\t\t\t CreateDialog() {\r\n\t\t\t\tthis.title='用户管理新增'\r\n\t\t\t\tthis.showNext = false\r\n\t\t\t\tthis.showStatus=true\r\n\t\t\t\tthis.iconType =\"form\"\r\n\t\t\t\tthis.showCanel = true\r\n\t\t\t\tthis.disabled=false\r\n\t\t\t\tthis.showVisible = true\r\n\t\t\t\tthis.current = 0\r\n\t\t\t\tthis.dialogType='create'\r\n\t\t\t\tthis.stepstatus =\"process\"\r\n\t\t\t\tthis.canelTitle=\"取消\"\r\n\t\t\t\tthis.showCanel = true\r\n\t\t\t\tthis.selectedRowKeys = []\r\n\t\t\t\tthis.form.resetFields();//清除缓存数据\r\n\t\t\t\tthis.query={\r\n\t\t\t\t  login: '',\r\n\t\t\t\t  name: '',\r\n\t\t\t\t  status: '',\r\n\t\t\t\t  page:1,\r\n\t\t\t\t  pageSize:5\r\n\t\t\t\t}\r\n\t\t\t },\r\n\t\t\t \r\n\t\t\t // 修改\r\n\t\t\t updateDialog(query){\r\n\t\t\t\tthis.title='用户管理修改'\r\n\t\t\t\tthis.showStatus=true\r\n\t\t\t\tthis.iconType =\"form\"\r\n\t\t\t\tthis.showCanel = true\r\n\t\t\t\tthis.disabled=false\r\n\t\t\t\tthis.showVisible = true\r\n\t\t\t\tthis.current = 0\r\n\t\t\t\tthis.dialogType='update'\r\n\t\t\t\tthis.canelTitle=\"取消\"\r\n\t\t\t\tthis.stepstatus =\"process\"\r\n\t\t\t\tthis.showCanel = true\r\n\t\t\t\tthis.selectedRowKeys = []\r\n\t\t\t\tthis.id=query.id;\r\n\t\t\t\tthis.query={\r\n\t\t\t\t  login: '',\r\n\t\t\t\t  name: '',\r\n\t\t\t\t  status: '',\r\n\t\t\t\t  page:1,\r\n\t\t\t\t  pageSize:5\r\n\t\t\t\t}\r\n\t\t\t\tthis.form.resetFields();//清除缓存数据 \r\n\t\t\t\t this.showNext = true\r\n\t\t\t\tthis.$nextTick(()=>{\r\n\t\t\t\t    this.form.setFieldsValue(query)\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t },\r\n\t\t\t \r\n\t\t\t getRoleIdsByUserId(){\r\n\t\t\t\t  let _this = this\r\n\t\t\t\t getRoleIdsByUserId({userId:this.id}).then(res=>{\r\n\t\t\t\t \tif(res.data.code=='0000'){\r\n\t\t\t\t \t\tthis.canelTitle=\"关闭\"\r\n\t\t\t\t \t\tthis.showCanel = true\r\n\t\t\t\t \t\tthis.showNext = true\r\n\t\t\t\t \t\tthis.current=1\r\n\t\t\t\t\t\tthis.selectedRowKeys = res.data.extend;\r\n\t\t\t\t \t\t}else{\r\n\t\t\t\t\t\tthis.current=1;\r\n\t\t\t\t\t\t_this.stepstatus = 'error';\r\n\t\t\t\t \t\t }\r\n\t\t\t\t \t\t}).catch(function(error){\r\n\t\t\t\t\t\t\tthis.current=1;\r\n\t\t\t\t \t\t _this.stepstatus = 'error';\r\n\t\t\t\t \t\t})\r\n\t\t\t },\r\n\t\t\t submitCreate(){\r\n\t\t\t\t if(this.current ==0){\r\n\t\t\t\t\t if(this.dialogType==\"create\"){\r\n\t\t\t\t\t\t this.create();\r\n\t\t\t\t\t }else if(this.dialogType==\"update\"){\r\n\t\t\t\t\t\t this.update();\r\n\t\t\t\t\t }\r\n\t\t\t\t\t \r\n\t\t\t\t }else if(this.current == 1){//添加关联表信息\r\n\t\t\t\t\t this.addUserIdAndRoleIds();\r\n\t\t\t\t }else{\r\n\t\t\t\t\t this.current=2\r\n\t\t\t\t }\r\n\t\t\t },\r\n\t\t\t // 直接进入第三步\r\n\t\t\t goNext(){\r\n\t\t\t\t if(this.current==0){\r\n\t\t\t\t\t\r\n\t\t\t\t\t  this.getList();\r\n\t\t\t\t\t  \r\n\t\t\t\t }else{\r\n\t\t\t\t\t this.canelTitle=\"关闭\"\r\n\t\t\t\t\t this.showCanel = true\r\n\t\t\t\t\t this.showNext = false\r\n\t\t\t\t\t  this.current=2\r\n\t\t\t\t }\r\n\t\t\t\r\n\t\t\t },\r\n\t\t\t \r\n\t\t\t \r\n\t\t\t addUserIdAndRoleIds(){\r\n\t\t\t\t let _this = this\r\n\t\t\t\t addUserIdAndRoleIds({userId:this.id,roleIds:this.selectedRowKeys.join(\",\")}).then(res=>{\r\n\t\t\t\t\t if(res.data.code=='0000'){\r\n\t\t\t\t\t\t this.canelTitle=\"关闭\"\r\n\t\t\t\t\t\t this.showCanel = true\r\n\t\t\t\t\t\t this.showNext = false\r\n\t\t\t\t\t\t this.current=2\r\n\t\t\t\t\t }else{\r\n\t\t\t\t\t\t this.$message.error(res.data.message)\r\n\t\t\t\t\t\t _this.stepstatus = 'error';\r\n\t\t\t\t\t }\r\n\t\t\t\t }).catch(function(error){\r\n\t\t\t\t\t\t _this.stepstatus = 'error';\r\n\t\t\t\t\t});\r\n\t\t\t },\r\n\t\t\t \r\n\t\t\t getList(){\r\n\t\t\t \tthis.loading=true\r\n\t\t\t \t getRolesByPage(this.query).then(res=>{\r\n\t\t\t \t\tif(res.data.code=='0000'){\r\n\t\t\t\t\t\tthis.showNext = true \r\n\t\t\t \t\t\tthis.loading=false\r\n\t\t\t\t\t\tthis.showCanel = false\r\n\t\t\t\t\t\tthis.current=1;\r\n\t\t\t \t\t\tconsole.log(res)\r\n\t\t\t \t\t\tthis.list = res.data.extend.list\r\n\t\t\t \t\t\tthis.pagination.total = res.data.extend.total;\r\n\t\t\t\t\t\tif(this.dialogType==\"update\"){\r\n\t\t\t\t\t\t\tthis.getRoleIdsByUserId()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t \t\t}else{\r\n\t\t\t\t\t\tthis.current=1;\r\n\t\t\t\t\t\t_this.stepstatus = 'error';\r\n\t\t\t \t\t\tthis.loading=false\r\n\t\t\t \t\t\tthis.$message.error(res.data.message)\r\n\t\t\t \t\t}\r\n\t\t\t \t }).catch(function(error){\r\n\t\t\t\t\t\t\t  this.current=1;\r\n\t\t\t\t\t\t\t  _this.stepstatus = 'error';\r\n\t\t\t\t\t\t  })\r\n\t\t\t },\r\n\t\t\t //新增\r\n\t\t\t create(){\r\n\t\t\t\t let _this= this;\r\n\t\t\t \t\t this.form.validateFields((err, values) => {\r\n\t\t\t \t\t  if(!err){\r\n\t\t\t \t\t\t  adduser(values).then(res=>{\r\n\t\t\t \t\t\t\tif(res.data.code=='0000'){\r\n\t\t\t\t\t\t\t\tthis.id = res.data.extend;\r\n\t\t\t\t\t\t\t\tthis.$emit('fresh')\r\n\t\t\t\t\t\t\t\tthis.getList();\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t \t\t\t\t\t//this.$message.success(res.data.message)\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t \t\t\t\t\t\r\n\t\t\t \t\t\t\t}else{\r\n\t\t\t \t\t\t\t\tthis.$message.error(res.data.message)\r\n\t\t\t\t\t\t\t\t_this.stepstatus = 'error';\r\n\t\t\t \t\t\t\t}\r\n\t\t\t \t\t\t  }).catch(function(error){\r\n\t\t\t\t\t\t\t  _this.stepstatus = 'error';\r\n\t\t\t\t\t\t  })\r\n\t\t\t \t\t\t  //this.showVisible = false\r\n\t\t\t \t\t\t}\r\n\t\t\t \t\t  });\r\n\t\t\t },\r\n\t\t\t //修改\r\n\t\t\t update(){\r\n\t\t\t \t\t  this.form.validateFields((err, values) => {\r\n\t\t\t \t\t   if(!err){\r\n\t\t\t \t\t\t  updateUser(values).then(res=>{\r\n\t\t\t \t\t\t\t  //console.log(res)\r\n\t\t\t \t\t\t\tif(res.data.code=='0000'){\r\n\t\t\t\t\t\t\t\tthis.getList();\r\n\t\t\t \t\t\t\t\tthis.$message.success(res.data.message)\r\n\t\t\t \t\t\t\t\tthis.$emit('fresh')\r\n\t\t\t \t\t\t\t}else{\r\n\t\t\t \t\t\t\t\tthis.$message.error(res.data.message)\r\n\t\t\t \t\t\t\t}\r\n\t\t\t \t\t\t  })\r\n\t\t\t \t\t\t  \r\n\t\t\t \t\t\t}\r\n\t\t\t \t\t   });\r\n\t\t\t },\r\n\t\t\t onSelectChange(selectedRowKeys) {\r\n\t\t\t\t console.info(selectedRowKeys)\r\n\t\t\t   this.selectedRowKeys = selectedRowKeys;\r\n\t\t\t },\r\n\t\t\t //健康状态\r\n\t\t\t healthType(status){\r\n\t\t\t\t  if(status=='0'){\r\n\t\t\t\t\treturn 'success'\r\n\t\t\t\t  }else if(status=='1'){\r\n\t\t\t\t\treturn 'warning'\r\n\t\t\t\t  }else if(status=='2'){\r\n\t\t\t\t\treturn 'error'\r\n\t\t\t\t  }\r\n\t\t\t\t  else{\r\n\t\t\t\t\treturn 'default'\r\n\t\t\t\t  }\r\n\t\t\t },\r\n\t\t\t toggle() {\r\n\t\t\t \tthis.expand = !this.expand\r\n\t\t\t },\r\n\t\t\t \r\n\t\t\t //关闭\r\n\t\t\t onClose(){\r\n\t\t\t\t  this.showVisible = false;\r\n\t\t\t\t  this.form.resetFields();\r\n\t\t\t\t  this.$message.info('已取消操作！')\r\n\t\t\t },\r\n\t\t\t \r\n\t\t\t //选择归属ecc展示系统\r\n\t\t\t showBounced(){\r\n\t\t\t \tthis.$refs.bounced.showChildrenDrawer()\r\n\t\t\t \t// console.log(this.$refs.bounced)\r\n\t\t\t },\r\n\t\t },\r\n\t\r\n\t }\r\n\t\n</script>\n\n<style>\r\n\t.stepContent{\r\n\t\tmargin-top:30px;\r\n\t}\n</style>\n"]}]}